Warning: SetDeviceLostCallback is deprecated. Pass the callback in the device descriptor instead.
Warning: Old CreateRenderPipelineAsync APIs are deprecated. If using C please pass a CallbackInfo struct that has two userdatas. Otherwise, if using C++, please use templated helpers.
Warning: Old GetCompilationInfo APIs are deprecated. If using C please pass a CallbackInfo struct that has two userdatas. Otherwise, if using C++, please use templated helpers.
=================================================================
==15386==ERROR: AddressSanitizer: heap-use-after-free on address 0x6080000166c8 at pc 0x7f7fcf1d85be bp 0x7ffcf6bcd780 sp 0x7ffcf6bcd778
READ of size 8 at 0x6080000166c8 thread T0
    #0 0x7f7fcf1d85bd in wgpu::interop::detail::PromiseBase::GetState() const /home/leu/Documents/projects/fyp/dawn/src/dawn/node/interop/Core.h:229:44
    #1 0x7f7fcf1d165b in wgpu::binding::GPUDevice::GPUDevice(Napi::Env, wgpu::DeviceDescriptor const&, wgpu::Device, std::shared_ptr<wgpu::binding::AsyncRunner>)::$_2::operator()(WGPUDeviceLostReason, char const*, void*) const /home/leu/Documents/projects/fyp/dawn/src/dawn/node/binding/GPUDevice.cpp:193:37
    #2 0x7f7fcf1d13c2 in wgpu::binding::GPUDevice::GPUDevice(Napi::Env, wgpu::DeviceDescriptor const&, wgpu::Device, std::shared_ptr<wgpu::binding::AsyncRunner>)::$_2::__invoke(WGPUDeviceLostReason, char const*, void*) /home/leu/Documents/projects/fyp/dawn/src/dawn/node/binding/GPUDevice.cpp:175:9
    #3 0x7f7fcf861ece in dawn::native::DeviceBase::DeviceLostEvent::Complete(dawn::EventCompletionType) /home/leu/Documents/projects/fyp/dawn/src/dawn/native/Device.cpp:248:9
    #4 0x7f7fcf9a8156 in dawn::native::EventManager::TrackedEvent::EnsureComplete(dawn::EventCompletionType) /home/leu/Documents/projects/fyp/dawn/src/dawn/native/EventManager.cpp:592:9
    #5 0x7f7fcf9a8d30 in dawn::native::EventManager::ProcessPollEvents() /home/leu/Documents/projects/fyp/dawn/src/dawn/native/EventManager.cpp:476:16
    #6 0x7f7fcfa28eeb in dawn::native::InstanceBase::ProcessEvents() /home/leu/Documents/projects/fyp/dawn/src/dawn/native/Instance.cpp:554:38
    #7 0x7f7fcfa29134 in dawn::native::InstanceBase::APIProcessEvents() /home/leu/Documents/projects/fyp/dawn/src/dawn/native/Instance.cpp:559:5
    #8 0x7f7fcf7028b1 in dawn::native::NativeInstanceProcessEvents(WGPUInstanceImpl*) /home/leu/Documents/projects/fyp/dawn/out/asan/gen/src/dawn/native/ProcTable.cpp:1316:15
    #9 0x7f7fd05c0968 in wgpuInstanceProcessEvents /home/leu/Documents/projects/fyp/dawn/out/asan/gen/src/dawn/dawn_proc.cpp:598:5
    #10 0x7f7fcf22e19c in wgpu::Instance::ProcessEvents() const /home/leu/Documents/projects/fyp/dawn/out/asan/gen/include/dawn/webgpu_cpp.h:7920:5
    #11 0x7f7fcf22c713 in wgpu::binding::AsyncRunner::QueueTick(Napi::Env)::$_0::operator()(Napi::CallbackInfo const&) const /home/leu/Documents/projects/fyp/dawn/src/dawn/node/binding/AsyncRunner.cpp:66:50
    #12 0x7f7fcf22c491 in Napi::details::CallbackData<wgpu::binding::AsyncRunner::QueueTick(Napi::Env)::$_0, void>::Wrapper(napi_env__*, napi_callback_info__*)::'lambda'()::operator()() const /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:133:7
    #13 0x7f7fcf22c22c in napi_value__* Napi::details::WrapCallback<Napi::details::CallbackData<wgpu::binding::AsyncRunner::QueueTick(Napi::Env)::$_0, void>::Wrapper(napi_env__*, napi_callback_info__*)::'lambda'()>(Napi::details::CallbackData<wgpu::binding::AsyncRunner::QueueTick(Napi::Env)::$_0, void>::Wrapper(napi_env__*, napi_callback_info__*)::'lambda'()) /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:87:10
    #14 0x7f7fcf22c00c in Napi::details::CallbackData<wgpu::binding::AsyncRunner::QueueTick(Napi::Env)::$_0, void>::Wrapper(napi_env__*, napi_callback_info__*) /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:128:12
    #15 0x55db867f401c in v8impl::(anonymous namespace)::FunctionCallbackWrapper::Invoke(v8::FunctionCallbackInfo<v8::Value> const&) js_native_api_v8.cc
    #16 0x55db2734eadc in Builtins_CallApiCallbackGeneric embedded.o

0x6080000166c8 is located 40 bytes inside of 88-byte region [0x6080000166a0,0x6080000166f8)
freed by thread T0 here:
    #0 0x7f7fdb4b522d in operator delete(void*) (/usr/lib/llvm-14/lib/clang/14.0.0/lib/linux/libclang_rt.asan-x86_64.so+0xdc22d) (BuildId: a6105a816e63299474c1078329a59ed80f244fbf)
    #1 0x7f7fcf1c6061 in wgpu::binding::GPUDevice::~GPUDevice() /home/leu/Documents/projects/fyp/dawn/src/dawn/node/binding/GPUDevice.cpp:201:25
    #2 0x7f7fcf1c4cf6 in std::default_delete<wgpu::interop::GPUDevice>::operator()(wgpu::interop::GPUDevice*) const /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/unique_ptr.h:95:2
    #3 0x7f7fcf1b9c70 in std::unique_ptr<wgpu::interop::GPUDevice, std::default_delete<wgpu::interop::GPUDevice> >::~unique_ptr() /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/unique_ptr.h:396:4
    #4 0x7f7fcf5152c0 in wgpu::interop::(anonymous namespace)::Wrappers::WGPUDevice::~WGPUDevice() /home/leu/Documents/projects/fyp/dawn/out/asan/gen/node/src/dawn/node/interop/WebGPU.cpp:2346:10
    #5 0x7f7fcf5152e8 in wgpu::interop::(anonymous namespace)::Wrappers::WGPUDevice::~WGPUDevice() /home/leu/Documents/projects/fyp/dawn/out/asan/gen/node/src/dawn/node/interop/WebGPU.cpp:2346:10
    #6 0x7f7fcf515695 in Napi::ObjectWrap<wgpu::interop::(anonymous namespace)::Wrappers::WGPUDevice>::FinalizeCallback(napi_env__*, void*, void*) /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:4885:3
    #7 0x55db868179fe in node_napi_env__::CallFinalizer(void (*)(napi_env__*, void*, void*), void*, void*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xa179fe) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #8 0x55db867f4fa5 in v8impl::TrackedFinalizer::FinalizeCore(bool) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0x9f4fa5) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #9 0x55db8681c5af in node::CallbackQueue<void, node::Environment*>::CallbackImpl<node_napi_env__::EnqueueFinalizer(v8impl::RefTracker*)::'lambda'(node::Environment*)>::Call(node::Environment*) node_api.cc
    #10 0x55db867b7914 in node::Environment::RunAndClearNativeImmediates(bool)::'lambda'(node::CallbackQueue<void, node::Environment*>*)::operator()(node::CallbackQueue<void, node::Environment*>*) const env.cc
    #11 0x55db867d0282 in node::Environment::RunAndClearNativeImmediates(bool) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0x9d0282) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #12 0x55db867d06d8 in node::Environment::CheckImmediate(uv_check_s*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0x9d06d8) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #13 0x7f7fdb39eca8 in uv__run_check (/home/linuxbrew/.linuxbrew/opt/libuv/lib/libuv.so.1+0x18ca8) (BuildId: 8760571cc4e43701934035f25e7982586468c2ad)
    #14 0x7ffcf6bced3f  ([stack]+0x4ad3f)

previously allocated by thread T0 here:
    #0 0x7f7fdb4b49cd in operator new(unsigned long) (/usr/lib/llvm-14/lib/clang/14.0.0/lib/linux/libclang_rt.asan-x86_64.so+0xdb9cd) (BuildId: a6105a816e63299474c1078329a59ed80f244fbf)
    #1 0x7f7fcf1b9729 in std::__detail::_MakeUniq<wgpu::binding::GPUDevice>::__single_object std::make_unique<wgpu::binding::GPUDevice, Napi::Env&, wgpu::DeviceDescriptor&, WGPUDeviceImpl*&, std::shared_ptr<wgpu::binding::AsyncRunner>&>(Napi::Env&, wgpu::DeviceDescriptor&, WGPUDeviceImpl*&, std::shared_ptr<wgpu::binding::AsyncRunner>&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/unique_ptr.h:1065:30
    #2 0x7f7fcf1b660f in wgpu::binding::GPUAdapter::requestDevice(Napi::Env, wgpu::interop::GPUDeviceDescriptor) /home/leu/Documents/projects/fyp/dawn/src/dawn/node/binding/GPUAdapter.cpp:196:23
    #3 0x7f7fcf527013 in wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter::requestDeviceInner(Napi::CallbackInfo const&) /home/leu/Documents/projects/fyp/dawn/out/asan/gen/node/src/dawn/node/interop/WebGPU.cpp:2777:31
    #4 0x7f7fcf5268d1 in wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter::requestDevice(Napi::CallbackInfo const&)::'lambda'()::operator()() const /home/leu/Documents/projects/fyp/dawn/out/asan/gen/node/src/dawn/node/interop/WebGPU.cpp:2766:75
    #5 0x7f7fcf5263e6 in Napi::Value wgpu::interop::CatchExceptionIntoPromise<wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter::requestDevice(Napi::CallbackInfo const&)::'lambda'()>(Napi::Env, wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter::requestDevice(Napi::CallbackInfo const&)::'lambda'()&&) /home/leu/Documents/projects/fyp/dawn/src/dawn/node/interop/Core.h:814:26
    #6 0x7f7fcf51cc81 in wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter::requestDevice(Napi::CallbackInfo const&) /home/leu/Documents/projects/fyp/dawn/out/asan/gen/node/src/dawn/node/interop/WebGPU.cpp:2766:14
    #7 0x7f7fcf524e03 in Napi::InstanceWrap<wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter>::InstanceMethodCallbackWrapper(napi_env__*, napi_callback_info__*)::'lambda'()::operator()() const /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:4375:23
    #8 0x7f7fcf5247ee in napi_value__* Napi::details::WrapCallback<Napi::InstanceWrap<wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter>::InstanceMethodCallbackWrapper(napi_env__*, napi_callback_info__*)::'lambda'()>(Napi::InstanceWrap<wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter>::InstanceMethodCallbackWrapper(napi_env__*, napi_callback_info__*)::'lambda'()) /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:87:10
    #9 0x7f7fcf52397c in Napi::InstanceWrap<wgpu::interop::(anonymous namespace)::Wrappers::WGPUAdapter>::InstanceMethodCallbackWrapper(napi_env__*, napi_callback_info__*) /home/leu/Documents/projects/fyp/dawn/third_party/node-addon-api/napi-inl.h:4368:10
    #10 0x55db867f401c in v8impl::(anonymous namespace)::FunctionCallbackWrapper::Invoke(v8::FunctionCallbackInfo<v8::Value> const&) js_native_api_v8.cc
    #11 0x55db2734eadc in Builtins_CallApiCallbackGeneric embedded.o
    #12 0x55db2734cf17 in Builtins_InterpreterEntryTrampoline embedded.o
    #13 0x55db27389e42 in Builtins_AsyncFunctionAwaitResolveClosure embedded.o
    #14 0x55db274561b0 in Builtins_PromiseFulfillReactionJob embedded.o
    #15 0x55db273774e7 in Builtins_RunMicrotasks embedded.o
    #16 0x55db2734aa42 in Builtins_JSRunMicrotasksEntry embedded.o
    #17 0x55db86bca025 in v8::internal::(anonymous namespace)::Invoke(v8::internal::Isolate*, v8::internal::(anonymous namespace)::InvokeParams const&) execution.cc
    #18 0x55db86bcae1f in v8::internal::(anonymous namespace)::InvokeWithTryCatch(v8::internal::Isolate*, v8::internal::(anonymous namespace)::InvokeParams const&) execution.cc
    #19 0x55db86bcb0d7 in v8::internal::Execution::TryRunMicrotasks(v8::internal::Isolate*, v8::internal::MicrotaskQueue*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xdcb0d7) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #20 0x55db86bf9a16 in v8::internal::MicrotaskQueue::RunMicrotasks(v8::internal::Isolate*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xdf9a16) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #21 0x55db86bf9d82 in v8::internal::MicrotaskQueue::PerformCheckpointInternal(v8::Isolate*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xdf9d82) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #22 0x55db8676c9a3 in node::InternalCallbackScope::Close() (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0x96c9a3) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #23 0x55db8676cbc4 in node::InternalCallbackScope::~InternalCallbackScope() (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0x96cbc4) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #24 0x55db86875df7 in node::fs::FileHandle::CloseReq::Resolve() (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xa75df7) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #25 0x55db86876c98 in node::fs::FileHandle::ClosePromise()::'lambda'(uv_fs_s*)::_FUN(uv_fs_s*) node_file.cc
    #26 0x55db868511ed in node::MakeLibuvRequestCallback<uv_fs_s, void (*)(uv_fs_s*)>::Wrapper(uv_fs_s*) (/home/linuxbrew/.linuxbrew/Cellar/node/21.7.3/bin/node+0xa511ed) (BuildId: 0d36d9e07656c1b6a4dd9a2b03ac478fb98b3e5f)
    #27 0x7f7fdb392ddd in uv__work_done (/home/linuxbrew/.linuxbrew/opt/libuv/lib/libuv.so.1+0xcddd) (BuildId: 8760571cc4e43701934035f25e7982586468c2ad)
    #28 0x7ffcf6bcab5f  ([stack]+0x46b5f)

SUMMARY: AddressSanitizer: heap-use-after-free /home/leu/Documents/projects/fyp/dawn/src/dawn/node/interop/Core.h:229:44 in wgpu::interop::detail::PromiseBase::GetState() const
Shadow bytes around the buggy address:
  0x0c107fffac80: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffac90: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffaca0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffacb0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c107fffacc0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa
=>0x0c107fffacd0: fa fa fa fa fd fd fd fd fd[fd]fd fd fd fd fd fa
  0x0c107ffface0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffacf0: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffad00: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa
  0x0c107fffad10: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
  0x0c107fffad20: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==15386==ABORTING
